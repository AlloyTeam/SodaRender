/**
 * SodaRender
 * light Tml render engine
 * copyright @ Tencent AlloyTeam
 * License under MIT License
 * @author dorsywang
 * @email 314416946@qq.com
 * @blog http://www.dorsywang.com
 * @TeamBlog http://www.alloyteam.com
 */
(function(){var e=/\{\{([^\}]*)\}\}/g,t=function(e,n){var r=n.indexOf(".");if(r>-1){var i=n.substr(0,r);return n=n.substr(r+1),e[i]?t(e[i],n):""}return e[n]||""},n=function(e){},r=/[a-zA-Z_\$]+[\w\$]*/g,i=/"([^"]*)"|'([^']*)'/g,s=/\d+|\d*\.\d+/g,o=/[a-zA-Z_\$]+[\w\$]*(?:\s*\.\s*(?:[a-zA-Z_\$]+[\w\$]*|\d+))*/g,u=/\[([^\[\]]*)\]/g,a=/\.([a-zA-Z_\$]+[\w\$]*)/g,f=/[^\.|]([a-zA-Z_\$]+[\w\$]*)/g,l=function(){return"$$"+~~(Math.random()*1e6)},c=function(e,n){var e=e.split("|"),r=e[0]||"",s=e.slice(1);r=r.replace(i,function(e,t,r){var i=l();return n[i]=t||r,i});while(u.test(r))u.lastIndex=0,r=r.replace(u,function(e,t){return"."+c(t,n)});r=r.replace(o,function(e){return"getValue(scope,'"+e.trim()+"')"});var a=function(){var e=s.shift();if(!e)return;var e=e.split(":"),t=e.slice(1)||[],n=e[0]||"";d[n]&&(t.unshift(r),t=t.join(","),r="sodaFilterMap['"+n+"']("+t+")"),a()};a();var f=(new Function("getValue","sodaFilterMap","return function sodaExp(scope){ return "+r+"}"))(t,d);return f(n)},h=function(t,n){[].map.call([].slice.call(t.childNodes,[]),function(t){t.nodeType===3&&(t.nodeValue=t.nodeValue.replace(e,function(e,t){return c(t,n)})),t.attributes&&(/in/.test(t.getAttribute("soda-repeat")||"")?p["soda-repeat"].link(n,t,t.attributes):([].map.call(t.attributes,function(r){if(/^soda-/.test(r.name)){if(p[r.name]){var i=p[r.name];i.link(n,t,t.attributes)}}else r.value=r.value.replace(e,function(e,t){return c(t,n)})}),h(t,n)))})},p={},d={},v=function(e,t){p["soda-"+e]=t()},m=function(e,t){d[e]=t};m("date",function(e,t){return t}),v("repeat",function(){return{compile:function(e,t,n){},link:function(n,r,i){var s=r.getAttribute("soda-repeat"),o,u;if(!/in/.test(s))return;s=s.split("in"),o=s[0].trim(),u=s[1].trim();var a=t(n,u),f=r;for(var l=0;l<a.length;l++){var d=r.cloneNode(),v={$index:l};v[o]=a[l],v.__proto__=n,d.innerHTML=r.innerHTML,[].map.call(d.attributes,function(t){if(d.getAttribute("removed")==="removed")return;if(t.name.trim()!=="soda-repeat")if(/^soda-/.test(t.name)){if(p[t.name]){var n=p[t.name];n.link(v,d,d.attributes)}}else t.value=t.value.replace(e,function(e,t){return c(t,v)})}),d.getAttribute("removed")!=="removed"&&(h(d,v),r.parentNode.insertBefore(d,f.nextSibling),f=d)}r.parentNode.removeChild(r)}}}),v("if",function(){return{link:function(e,t,n){var r=t.getAttribute("soda-if"),i=c(r,e);i||(t.setAttribute("removed","removed"),t.parentNode&&t.parentNode.removeChild(t))}}});var g=function(e,t){var n=document.createElement("div");n.innerHTML=e,h(n,t);var r=document.createDocumentFragment();r.innerHTML=n.innerHTML;var i;while(i=n.childNodes[0])r.appendChild(i);return r},y=function(e,t){};window.sodaRender=g,window.sodaFilter=m})()
