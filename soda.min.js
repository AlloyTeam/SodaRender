/**
 * sodajs v0.1.0 by dorsywang
 * Light weight but powerful template engine for JavaScript
 * Github: https://github.com/AlloyTeam/sodajs
 * MIT License
 */

;(function(){var r=/\{\{([^\}]*)\}\}/g,c=function(n){return new RegExp("(^|\\s+)"+n+"(\\s+|$)","g")},b=function(n,t){if(!n.className){n.className=t;return}n.className.match(c(t))||(n.className+=" "+t)},rt=function(n,t){n.className=n.className.replace(c(t),"")},l=function(n,t){p.lastIndex=0;var i=t.replace(p,function(t){return typeof n[t]=="undefined"?t:n[t]}),r=function(t,u){var o=u.indexOf("."),f,s,e;return o>-1?(f=u.substr(0,o),u=u.substr(o+1),n[f]&&y.test(f)&&(f=n[f]),typeof t[f]!="undefined"?r(t[f],u):(e={name:i,data:n},h("nullvalue",{type:"nullattr",data:e},e),"")):(n[u]&&y.test(u)&&(u=n[u]),typeof t[u]!="undefined"?s=t[u]:(e={name:i,data:n},h("nullvalue",{type:"nullvalue",data:e},e),s=""),s)};return r(n,t)},ut=function(){},k=/"([^"]*)"|'([^']*)'/g,a=/[a-zA-Z_\$]+[\w\$]*(?:\s*\.\s*(?:[a-zA-Z_\$]+[\w\$]*|\d+))*/g,e=/\[([^\[\]]*)\]/g,d=/\|\|/g,v="OR_OPERATOR\x1e",g=function(){return"$$"+~~(Math.random()*1e6)},nt="_$C$_",y=/^_\$C\$_/,p=/_\$C\$_[^\.]+/g,tt=function(){return nt+~~(Math.random()*1e6)},n=function(t,i){var u,r,o,f,h;for(t=t.replace(d,v).split("|"),u=0;u<t.length;u++)t[u]=(t[u].replace(new RegExp(v,"g"),"||")||"").trim();for(r=t[0]||"",o=t.slice(1),r=r.replace(k,function(n,t,r){var u=g();return i[u]=t||r,u});e.test(r);)e.lastIndex=0,r=r.replace(e,function(t,r){var u=tt(),f=n(r,i);return i[u]=f,"."+u});return r=r.replace(a,function(n){return"getValue(scope,'"+n.trim()+"')"}),f=function(){var i=o.shift(),t;if(i){var i=i.split(":"),n=i.slice(1)||[],u=i[0]||"";for(t=0;t<n.length;t++)a.test(n[t])&&(n[t]="getValue(scope,'"+n[t]+"')");s[u]&&(n.unshift(r),n=n.join(","),r="sodaFilterMap['"+u+"']("+n+")");f()}},f(),h=new Function("getValue","sodaFilterMap","return function sodaExp(scope){ return "+r+"}")(l,s),h(i)},o=function(i,u){[].map.call([].slice.call(i.childNodes,[]),function(i){if(i.nodeType===3&&(i.nodeValue=i.nodeValue.replace(r,function(t,i){return n(i,u)})),i.attributes)if(/in/.test(i.getAttribute("soda-repeat")||""))t["soda-repeat"].link(u,i,i.attributes);else{if((i.getAttribute("soda-if")||"").trim()&&(t["soda-if"].link(u,i,i.attributes),i.getAttribute("removed")==="removed"))return;var f;[].map.call(i.attributes,function(e){var h,o,s,c;e.name!=="soda-if"&&(/^soda-/.test(e.name)?t[e.name]?(h=t[e.name],o=h.link(u,i,i.attributes),o&&o.command==="childDone"&&(f=1)):(s=e.name.replace(/^soda-/,""),s&&(c=e.value.replace(r,function(t,i){return n(i,u)}),i.setAttribute(s,c))):e.value=e.value.replace(r,function(t,i){return n(i,u)}))});f||o(i,u)}})},t={},s={},u=function(n,i){t["soda-"+n]=i()},w=function(n,t){s[n]=t},i,f,h,it;w("date",function(n,t){return t});u("repeat",function(){return{compile:function(){},link:function(i,u){var a=u.getAttribute("soda-repeat"),v,y,h,b,c,p,w,s,f,e;if(a=a.replace(/\s+track\s+by\s+([^\s]+)$/,function(n,t){return t&&(h=(t||"").trim()),""}),h=h||"$index",b=/([^\s]+)\s+in\s+([^\s]+)/,c=b.exec(a),c){if(v=(c[1]||"").trim(),y=(c[2]||"").trim(),!(v&&y))return}else return;for(p=l(i,y)||[],w=u,s=0;s<p.length;s++)(f=u.cloneNode(),e={},e[h]=s,e[v]=p[s],e.__proto__=i,f.innerHTML=u.innerHTML,(f.getAttribute("soda-if")||"").trim()&&(t["soda-if"].link(e,f,f.attributes),f.getAttribute("removed")==="removed"))||([].map.call(f.attributes,function(u){var s,o,h;f.getAttribute("removed")!=="removed"&&u.name.trim()!=="soda-repeat"&&u.name.trim()!=="soda-if"&&(/^soda-/.test(u.name)?t[u.name]?(s=t[u.name],s.link(e,f,f.attributes)):(o=u.name.replace(/^soda-/,""),o&&(h=u.value.replace(r,function(t,r){return n(r,i)}),f.setAttribute(o,h))):u.value=u.value.replace(r,function(t,i){return n(i,e)}))}),f.getAttribute("removed")!=="removed"&&(o(f,e),u.parentNode.insertBefore(f,w.nextSibling),w=f));u.parentNode.removeChild(u)}}});u("if",function(){return{link:function(t,i){var r=i.getAttribute("soda-if"),u=n(r,t);u||(i.setAttribute("removed","removed"),i.parentNode&&i.parentNode.removeChild(i))}}});u("class",function(){return{link:function(t,i){var u=i.getAttribute("soda-class"),r=n(u,t);r&&b(i,r)}}});u("src",function(){return{link:function(t,i){var f=i.getAttribute("soda-src"),u=f.replace(r,function(i,r){return n(r,t)});u&&i.setAttribute("src",u)}}});u("bind-html",function(){return{link:function(t,i){var u=i.getAttribute("soda-bind-html"),r=n(u,t);if(r)return i.innerHTML=r,{command:"childDone"}}}});u("style",function(){return{link:function(t,i){var c=i.getAttribute("soda-style"),u=n(c,t),l=function(n,t){return/opacity|z-index/.test(n)?parseFloat(t):isNaN(t)?t:t+"px"},f,s,e,r,o,h;if(u){f=[];for(r in u)u.hasOwnProperty(r)&&(s=l(r,u[r]),f.push([r,s].join(":")));for(e=i.style,r=0;r<e.length;r++)o=e[r],u[o]||f.push([o,e[o]].join(":"));h=f.join(";");i.setAttribute("style",h)}}}});i=function(n,t){var i=document.createElement("div");return i.innerHTML=n,o(i,t),i.innerHTML};f={};i.addEventListener=function(n,t){f[n]||(f[n]=[]);f[n].push(t)};h=function(n,t,i){for(var u,e=f[n]||[],r=0;r<e.length;r++)u=e[r],u&&u(t,i)};it=function(){};i.filter=w;typeof exports=="object"&&typeof module=="object"?module.exports=i:typeof define=="function"&&define.amd?define([],function(){return i}):typeof exports=="object"?exports.soda=i:window.soda=i})();