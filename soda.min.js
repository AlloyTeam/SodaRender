/**
 * sodajs v0.4.1 by dorsywang
 * Light weight but powerful template engine for JavaScript
 * Github: https://github.com/AlloyTeam/sodajs
 * MIT License
 */

!function(){var C,D,E,a=/\{\{([^\}]*)\}\}/g,b=function(a){return new RegExp("(^|\\s+)"+a+"(\\s+|$)","g")},c=function(a,c){return a.className?(a.className.match(b(c))||(a.className+=" "+c),void 0):(a.className=c,void 0)},e=function(a,b){var c,d;return s.lastIndex=0,c=b.replace(s,function(b){return"undefined"==typeof a[b]?b:a[b]}),"true"===b?!0:"false"===b?!1:(d=function(b,e){var g,h,i,f=e.indexOf(".");return f>-1?(g=e.substr(0,f),e=e.substr(f+1),"undefined"!=typeof a[g]&&r.test(g)&&(g=a[g]),"undefined"!=typeof b[g]?d(b[g],e):(h={name:c,data:a},E("nullvalue",{type:"nullattr",data:h},h),"")):("undefined"!=typeof a[e]&&r.test(e)&&(e=a[e]),"undefined"!=typeof b[e]?i=b[e]:(h={name:c,data:a},E("nullvalue",{type:"nullvalue",data:h},h),i=""),i)},d(a,b))},h=/"([^"]*)"|'([^']*)'/g,j=/[a-zA-Z_\$]+[\w\$]*(?:\s*\.\s*(?:[a-zA-Z_\$]+[\w\$]*|\d+))*/g,k=/\[([^\[\]]*)\]/g,n=/\|\|/g,o="OR_OPERATOR",p=function(){return"$$"+~~(1e6*Math.random())},q="_$C$_",r=/^_\$C\$_/,s=/_\$C\$_[^\.]+/g,t=function(){return q+~~(1e6*Math.random())},u=function(a,b){var c,d,f,g,i;for(a=a.replace(n,o).split("|"),c=0;c<a.length;c++)a[c]=(a[c].replace(new RegExp(o,"g"),"||")||"").trim();for(d=a[0]||"",f=a.slice(1),d=d.replace(h,function(a,c,d){var e=p();return b[e]=c||d,e});k.test(d);)k.lastIndex=0,d=d.replace(k,function(a,c){var d=t(),e=u(c,b);return b[d]=e,"."+d});return d=d.replace(j,function(a){return"getValue(scope,'"+a.trim()+"')"}),g=function(){var b,c,h,a=f.shift();if(a){for(a=a.split(":"),b=a.slice(1)||[],c=a[0]||"",h=0;h<b.length;h++)j.test(b[h])&&(b[h]="getValue(scope,'"+b[h]+"')");y[c]&&(b.unshift(d),b=b.join(","),d="sodaFilterMap['"+c+"']("+b+")"),g()}},g(),i=new Function("getValue","sodaFilterMap","return function sodaExp(scope){ return "+d+"}")(e,y),i(b)},w=function(b,c){3===b.nodeType&&(b.nodeValue=b.nodeValue.replace(a,function(a,b){return u(b,c)})),b.attributes&&(z.map(function(a){var d=a.name,e=a.opt;b.getAttribute(d)&&b.parentNode&&e.link(c,b,b.attributes)}),[].map.call(b.attributes,function(d){var e,f;x[d.name]||(/^soda-/.test(d.name)?(e=d.name.replace(/^soda-/,""),e&&(f=d.value.replace(a,function(a,b){return u(b,c)}),b.setAttribute(e,f))):d.value=d.value.replace(a,function(a,b){return u(b,c)}))})),[].map.call([].slice.call(b.childNodes,[]),function(a){w(a,c)})},x={},y={},z=[],A=function(a,b){var a="soda-"+a;x[a]=b(),z.push({name:a,opt:x[a]})},B=function(a,b){y[a]=b};B.get=function(a){return y[a]},B("date",function(a,b){return b}),A("repeat",function(){return{priority:10,compile:function(){},link:function(a,b){var f,g,i,j,k,l,m,n,d=b.getAttribute("soda-repeat"),h=/\s+by\s+([^\s]+)$/;if(d=d.replace(h,function(a,b){return b&&(i=(b||"").trim()),""}),j=/([^\s]+)\s+in\s+([^\s]+)|\(([^,]+)\s*,\s*([^)]+)\)\s+in\s+([^\s]+)/,k=j.exec(d)){if(k[1]&&k[2]){if(f=(k[1]||"").trim(),g=(k[2]||"").trim(),!f||!g)return}else k[3]&&k[4]&&k[5]&&(i=(k[3]||"").trim(),f=(k[4]||"").trim(),g=(k[5]||"").trim());if(i=i||"$index",l=e(a,g)||[],m=function(c){var d=b.cloneNode(!0),e={};e[i]=c,e[f]=l[c],e.__proto__=a,d.removeAttribute("soda-repeat"),b.parentNode.insertBefore(d,b),w(d,e)},"length"in l)for(n=0;n<l.length;n++)m(n);else for(n in l)l.hasOwnProperty(n)&&m(n);b.parentNode.removeChild(b)}}}}),A("if",function(){return{priority:9,link:function(a,b){var d=b.getAttribute("soda-if"),e=u(d,a);e||b.parentNode&&b.parentNode.removeChild(b)}}}),A("class",function(){return{link:function(a,b){var e=b.getAttribute("soda-class"),f=u(e,a);f&&c(b,f)}}}),A("src",function(){return{link:function(b,c){var e=c.getAttribute("soda-src"),f=e.replace(a,function(a,c){return u(c,b)});f&&c.setAttribute("src",f)}}}),A("bind-html",function(){return{link:function(a,b){var d=b.getAttribute("soda-bind-html"),e=u(d,a);return e?(b.innerHTML=e,{command:"childDone"}):void 0}}}),A("html",function(){return{link:function(a,b){var d=b.getAttribute("soda-html"),e=u(d,a);return e?(b.innerHTML=e,{command:"childDone"}):void 0}}}),A("style",function(){return{link:function(a,b){var g,h,i,j,k,l,d=b.getAttribute("soda-style"),e=u(d,a),f=function(a,b){var c=/opacity|z-index/;return c.test(a)?parseFloat(b):isNaN(b)?b:b+"px"};if(e){g=[];for(h in e)e.hasOwnProperty(h)&&(i=f(h,e[h]),g.push([h,i].join(":")));for(j=b.style,h=0;h<j.length;h++)k=j[h],e[k]||g.push([k,j[k]].join(":"));l=g.join(";"),b.setAttribute("style",l)}}}}),C=function(a,b){var c;return z.sort(function(a,b){return Number(b.opt.priority||0)-Number(a.opt.priority||0)}),c=document.createElement("div"),c.innerHTML=a,[].map.call([].slice.call(c.childNodes,[]),function(a){w(a,b)}),c.innerHTML},D={},C.addEventListener=function(a,b){D[a]||(D[a]=[]),D[a].push(b)},C.author="dorsy",E=function(a,b,c){var e,f,d=D[a]||[];for(e=0;e<d.length;e++)f=d[e],f&&f(b,c)},C.filter=B,"object"==typeof exports&&"object"==typeof module?module.exports=C:"function"==typeof define&&define.amd?define([],function(){return C}):"object"==typeof exports?exports["soda"]=C:window.soda=C}();