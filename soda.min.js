/**
 * sodajs v0.4.3 by dorsywang
 * Light weight but powerful template engine for JavaScript
 * Github: https://github.com/AlloyTeam/sodajs
 * MIT License
 */(function(){Array.prototype.map||(Array.prototype.map=function(e){var t=[];for(var n=0;n<this.length;n++){var r=this[n];[].push(e&&e.call(r,r,n))}return t}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s*|\s*$/g,"")});var e=function(e){var t=[];for(var n=0;n<e.length;n++)t.push(e[n]);return t},t=/\{\{([^\}]*)\}\}/g,n="soda",r=new RegExp("^"+n+"-"),i=function(e){return new RegExp("(^|\\s+)"+e+"(\\s+|$)","g")},s=function(e,t){if(!e.className){e.className=t;return}e.className.match(i(t))||(e.className+=" "+t)},o=function(e,t){e.className=e.className.replace(i(t),"")},u=function(e,t){x.lastIndex=0;var n=t.replace(x,function(t){return typeof e[t]=="undefined"?t:e[t]});if(t==="true")return!0;if(t==="false")return!1;var r=function(t,i){var s=i.indexOf(".");if(s>-1){var o=i.substr(0,s);i=i.substr(s+1),typeof e[o]!="undefined"&&S.test(o)&&(o=e[o]);if(typeof t[o]!="undefined")return r(t[o],i);var u={name:n,data:e};return H("nullvalue",{type:"nullattr",data:u},u),""}typeof e[i]!="undefined"&&S.test(i)&&(i=e[i]);var a;if(typeof t[i]!="undefined")a=t[i];else{var u={name:n,data:e};H("nullvalue",{type:"nullvalue",data:u},u),a=""}return a};return r(e,t)},a=function(e){},f=/[a-zA-Z_\$]+[\w\$]*/g,l=/"([^"]*)"|'([^']*)'/g,c=/\d+|\d*\.\d+/g,h=/[a-zA-Z_\$]+[\w\$]*(?:\s*\.\s*(?:[a-zA-Z_\$]+[\w\$]*|\d+))*/g,p=/[a-zA-Z_\$]+[\w\$]*(?:\s*\.\s*(?:[a-zA-Z_\$]+[\w\$]*|\d+))*/,d=/\[([^\[\]]*)\]/g,v=/\[([^\[\]]*)\]/,m=/\.([a-zA-Z_\$]+[\w\$]*)/g,g=/[^\.|]([a-zA-Z_\$]+[\w\$]*)/g,y=/\|\|/g,b="OR_OPERATOR",w=function(){return"$$"+~~(Math.random()*1e6)},E="_$C$_",S=/^_\$C\$_/,x=/_\$C\$_[^\.]+/g,T=function(){return E+~~(Math.random()*1e6)},N=function(e,t){e=e.replace(y,b).split("|");for(var n=0;n<e.length;n++)e[n]=(e[n].replace(new RegExp(b,"g"),"||")||"").trim();var r=e[0]||"",i=e.slice(1);r=r.replace(l,function(e,n,r){var i=w();return t[i]=n||r,i});while(v.test(r))d.lastIndex=0,r=r.replace(d,function(e,n){var r=T(),i=N(n,t);return t[r]=i,"."+r});r=r.replace(h,function(e){return"getValue(scope,'"+e.trim()+"')"});var s=function(){var e=i.shift();if(!e)return;var e=e.split(":"),t=e.slice(1)||[],n=e[0]||"",o=/^'.*'$|^".*"$/;for(var u=0;u<t.length;u++)p.test(t[u])&&(t[u]="getValue(scope,'"+t[u]+"')");A[n]&&(t.unshift(r),t=t.join(","),r="sodaFilterMap['"+n+"']("+t+")"),s()};s();var o=(new Function("getValue","sodaFilterMap","return function sodaExp(scope){ return "+r+"}"))(u,A);return o(t)},C={id2Expression:{},expression2id:{},getRandId:function(){return"soda"+~~(Math.random()*1e5)}},k=function(n,i){n.nodeType===3&&(n.nodeValue=n.nodeValue.replace(t,function(e,t){return N(t,i)})),n.attributes&&(O.map(function(e){var t=e.name,r=e.opt;n.getAttribute(t)&&n.parentNode&&r.link(i,n,n.attributes)}),[].map.call(n.attributes,function(e){if(!L[e.name])if(r.test(e.name)){var s=e.name.replace(r,"");if(s&&e.value){var o=e.value.replace(t,function(e,t){return N(t,i)});n.setAttribute(s,o)}}else e.value&&(e.value=e.value.replace(t,function(e,t){return N(t,i)}))})),e(n.childNodes).map(function(e){k(e,i)})},L={},A={},O=[],M=function(e,t){var e=n+"-"+e;L[e]=t(),O.push({name:e,opt:L[e]})},_=function(e,t){A[e]=t};_.get=function(e){return A[e]},_("date",function(e,t){return t}),M("repeat",function(){return{priority:10,compile:function(e,t,n){},link:function(e,t,r){var i=t.getAttribute(n+"-repeat"),s,o,a=/\s+by\s+([^\s]+)$/,f;i=i.replace(a,function(e,t){return t&&(f=(t||"").trim()),""});var l=/([^\s]+)\s+in\s+([^\s]+)|\(([^,]+)\s*,\s*([^)]+)\)\s+in\s+([^\s]+)/,c=l.exec(i);if(!c)return;if(c[1]&&c[2]){s=(c[1]||"").trim(),o=(c[2]||"").trim();if(!s||!o)return}else c[3]&&c[4]&&c[5]&&(f=(c[3]||"").trim(),s=(c[4]||"").trim(),o=(c[5]||"").trim());f=f||"$index";var h=u(e,o)||[],p=function(r){var i=t.cloneNode(!0),o={};o[f]=r,o[s]=h[r],o.__proto__=e,i.removeAttribute(n+"-repeat"),t.parentNode.insertBefore(i,t),k(i,o)};if("length"in h)for(var d=0;d<h.length;d++)p(d);else for(var d in h)h.hasOwnProperty(d)&&p(d);t.parentNode.removeChild(t)}}}),M("if",function(){return{priority:9,link:function(e,t,r){var i=t.getAttribute(n+"-if"),s=N(i,e);s||t.parentNode&&t.parentNode.removeChild(t)}}}),M("class",function(){return{link:function(e,t,r){var i=t.getAttribute(n+"-class"),o=N(i,e);o&&s(t,o)}}}),M("src",function(){return{link:function(e,r,i){var s=r.getAttribute(n+"-src"),o=s.replace(t,function(t,n){return N(n,e)});o&&r.setAttribute("src",o)}}}),M("bind-html",function(){return{link:function(e,t,r){var i=t.getAttribute(n+"-bind-html"),s=N(i,e);if(s)return t.innerHTML=s,{command:"childDone"}}}}),M("html",function(){return{link:function(e,t,r){var i=t.getAttribute(n+"-html"),s=N(i,e);if(s)return t.innerHTML=s,{command:"childDone"}}}}),M("style",function(){return{link:function(e,t,r){var i=t.getAttribute(n+"-style"),s=N(i,e),o=function(e,t){var n=/opacity|z-index/;return n.test(e)?parseFloat(t):isNaN(t)?t:t+"px"};if(s){var u=[];for(var a in s)if(s.hasOwnProperty(a)){var f=o(a,s[a]);u.push([a,f].join(":"))}var l=t.style;for(var a=0;a<l.length;a++){var c=l[a];s[c]||u.push([c,l[c]].join(":"))}var h=u.join(";");t.setAttribute("style",h)}}}});var D=function(t,n){O.sort(function(e,t){return Number(t.opt.priority||0)-Number(e.opt.priority||0)});var r=document.createElement("div");document.documentMode<9&&(r.style.display="none",document.body.appendChild(r)),r.innerHTML=t,e(r.childNodes).map(function(e){k(e,n)});var i=r.innerHTML;document.documentMode<9&&document.body.removeChild(r);return i;var s},P={};D.addEventListener=function(e,t){P[e]||(P[e]=[]),P[e].push(t)};var H=function(e,t,n){var r=P[e]||[];for(var i=0;i<r.length;i++){var s=r[i];s&&s(t,n)}};D.filter=_,D.prefix=function(e){for(var t in L)L.hasOwnProperty(t)&&(L[t.replace(n,e)]=L[t],delete L[t]);var i=0,s=O.length;for(;i<s;i++)O[i].name=O[i].name.replace(n,e);n=e,r=new RegExp("^"+n+"-")},typeof exports=="object"&&typeof module=="object"?module.exports=D:typeof define=="function"&&define.amd?define([],function(){return D}):typeof exports=="object"?exports.soda=D:window.soda=D})()