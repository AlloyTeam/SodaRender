/**
 * sodajs v0.4.1 by dorsywang
 * Light weight but powerful template engine for JavaScript
 * Github: https://github.com/AlloyTeam/sodajs
 * MIT License
 */

!function(){var E,F,G,a=/\{\{([^\}]*)\}\}/g,b="soda",c=new RegExp("^"+b+"-"),d=function(a){return new RegExp("(^|\\s+)"+a+"(\\s+|$)","g")},e=function(a,b){return a.className?(a.className.match(d(b))||(a.className+=" "+b),void 0):(a.className=b,void 0)},g=function(a,b){var c,d;return u.lastIndex=0,c=b.replace(u,function(b){return"undefined"==typeof a[b]?b:a[b]}),"true"===b?!0:"false"===b?!1:(d=function(b,e){var g,h,i,f=e.indexOf(".");return f>-1?(g=e.substr(0,f),e=e.substr(f+1),"undefined"!=typeof a[g]&&t.test(g)&&(g=a[g]),"undefined"!=typeof b[g]?d(b[g],e):(h={name:c,data:a},G("nullvalue",{type:"nullattr",data:h},h),"")):("undefined"!=typeof a[e]&&t.test(e)&&(e=a[e]),"undefined"!=typeof b[e]?i=b[e]:(h={name:c,data:a},G("nullvalue",{type:"nullvalue",data:h},h),i=""),i)},d(a,b))},j=/"([^"]*)"|'([^']*)'/g,l=/[a-zA-Z_\$]+[\w\$]*(?:\s*\.\s*(?:[a-zA-Z_\$]+[\w\$]*|\d+))*/g,m=/\[([^\[\]]*)\]/g,p=/\|\|/g,q="OR_OPERATOR",r=function(){return"$$"+~~(1e6*Math.random())},s="_$C$_",t=/^_\$C\$_/,u=/_\$C\$_[^\.]+/g,v=function(){return s+~~(1e6*Math.random())},w=function(a,b){var c,d,e,f,h;for(a=a.replace(p,q).split("|"),c=0;c<a.length;c++)a[c]=(a[c].replace(new RegExp(q,"g"),"||")||"").trim();for(d=a[0]||"",e=a.slice(1),d=d.replace(j,function(a,c,d){var e=r();return b[e]=c||d,e});m.test(d);)m.lastIndex=0,d=d.replace(m,function(a,c){var d=v(),e=w(c,b);return b[d]=e,"."+d});return d=d.replace(l,function(a){return"getValue(scope,'"+a.trim()+"')"}),f=function(){var b,c,h,a=e.shift();if(a){for(a=a.split(":"),b=a.slice(1)||[],c=a[0]||"",h=0;h<b.length;h++)l.test(b[h])&&(b[h]="getValue(scope,'"+b[h]+"')");A[c]&&(b.unshift(d),b=b.join(","),d="sodaFilterMap['"+c+"']("+b+")"),f()}},f(),h=new Function("getValue","sodaFilterMap","return function sodaExp(scope){ return "+d+"}")(g,A),h(b)},y=function(b,d){3===b.nodeType&&(b.nodeValue=b.nodeValue.replace(a,function(a,b){return w(b,d)})),b.attributes&&(B.map(function(a){var c=a.name,e=a.opt;b.getAttribute(c)&&b.parentNode&&e.link(d,b,b.attributes)}),[].map.call(b.attributes,function(e){var f,g;z[e.name]||(c.test(e.name)?(f=e.name.replace(c,""),f&&(g=e.value.replace(a,function(a,b){return w(b,d)}),b.setAttribute(f,g))):e.value=e.value.replace(a,function(a,b){return w(b,d)}))})),[].map.call([].slice.call(b.childNodes,[]),function(a){y(a,d)})},z={},A={},B=[],C=function(a,c){var a=b+"-"+a;z[a]=c(),B.push({name:a,opt:z[a]})},D=function(a,b){A[a]=b};D.get=function(a){return A[a]},D("date",function(a,b){return b}),C("repeat",function(){return{priority:10,compile:function(){},link:function(a,c){var f,h,j,k,l,m,n,o,e=c.getAttribute(b+"-repeat"),i=/\s+by\s+([^\s]+)$/;if(e=e.replace(i,function(a,b){return b&&(j=(b||"").trim()),""}),k=/([^\s]+)\s+in\s+([^\s]+)|\(([^,]+)\s*,\s*([^)]+)\)\s+in\s+([^\s]+)/,l=k.exec(e)){if(l[1]&&l[2]){if(f=(l[1]||"").trim(),h=(l[2]||"").trim(),!f||!h)return}else l[3]&&l[4]&&l[5]&&(j=(l[3]||"").trim(),f=(l[4]||"").trim(),h=(l[5]||"").trim());if(j=j||"$index",m=g(a,h)||[],n=function(d){var e=c.cloneNode(!0),g={};g[j]=d,g[f]=m[d],g.__proto__=a,e.removeAttribute(b+"-repeat"),c.parentNode.insertBefore(e,c),y(e,g)},"length"in m)for(o=0;o<m.length;o++)n(o);else for(o in m)m.hasOwnProperty(o)&&n(o);c.parentNode.removeChild(c)}}}}),C("if",function(){return{priority:9,link:function(a,c){var e=c.getAttribute(b+"-if"),f=w(e,a);f||c.parentNode&&c.parentNode.removeChild(c)}}}),C("class",function(){return{link:function(a,c){var f=c.getAttribute(b+"-class"),g=w(f,a);g&&e(c,g)}}}),C("src",function(){return{link:function(c,d){var f=d.getAttribute(b+"-src"),g=f.replace(a,function(a,b){return w(b,c)});g&&d.setAttribute("src",g)}}}),C("bind-html",function(){return{link:function(a,c){var e=c.getAttribute(b+"-bind-html"),f=w(e,a);return f?(c.innerHTML=f,{command:"childDone"}):void 0}}}),C("html",function(){return{link:function(a,c){var e=c.getAttribute(b+"-html"),f=w(e,a);return f?(c.innerHTML=f,{command:"childDone"}):void 0}}}),C("style",function(){return{link:function(a,c){var h,i,j,k,l,m,e=c.getAttribute(b+"-style"),f=w(e,a),g=function(a,b){var c=/opacity|z-index/;return c.test(a)?parseFloat(b):isNaN(b)?b:b+"px"};if(f){h=[];for(i in f)f.hasOwnProperty(i)&&(j=g(i,f[i]),h.push([i,j].join(":")));for(k=c.style,i=0;i<k.length;i++)l=k[i],f[l]||h.push([l,k[l]].join(":"));m=h.join(";"),c.setAttribute("style",m)}}}}),E=function(a,b){var c;return B.sort(function(a,b){return Number(b.opt.priority||0)-Number(a.opt.priority||0)}),c=document.createElement("div"),c.innerHTML=a,[].map.call([].slice.call(c.childNodes,[]),function(a){y(a,b)}),c.innerHTML},F={},E.addEventListener=function(a,b){F[a]||(F[a]=[]),F[a].push(b)},G=function(a,b,c){var e,f,d=F[a]||[];for(e=0;e<d.length;e++)f=d[e],f&&f(b,c)},E.filter=D,E.prefix=function(a){var d,e,f;for(d in z)z.hasOwnProperty(d)&&(z[d.replace(b,a)]=z[d],delete z[d]);for(e=0,f=B.length;f>e;e++)B[e].name=B[e].name.replace(b,a);b=a,c=new RegExp("^"+b+"-")},"object"==typeof exports&&"object"==typeof module?module.exports=E:"function"==typeof define&&define.amd?define([],function(){return E}):"object"==typeof exports?exports["soda"]=E:window.soda=E}();